{% extends 'base.html' %} {% block content %} {% if messages %}
<div class="mt-3">
  {% for message in messages %}
  <div
    class="alert alert-{% if message.tags == 'error' %}danger{% else %}info{% endif %}"
    role="alert"
  >
    {{ message }}
  </div>
  {% endfor %}
</div>
{% endif %}

<!-- Tarjeta contenedora -->
<div class="card">
  <div class="card-header">
    <ul class="nav nav-tabs card-header-tabs" id="materiaTabs" role="tablist">
      <!-- Generar pestañas dinámicamente para cada materia -->
      {% for materia in materias_disponibles %}
      <li class="nav-item">
        <a
          class="nav-link"
          id="materia-{{ forloop.counter }}-tab"
          data-bs-toggle="tab"
          href="#materia-{{ forloop.counter }}"
          role="tab"
        >
          {{ materia }}
        </a>
      </li>
      {% endfor %}
    </ul>
  </div>

  <div class="card-body">
    <div class="tab-content" id="materiaTabsContent">
      <!-- Generar contenido dinámico para cada materia -->
      {% for materia in materias_disponibles %}
      <div
        class="tab-pane fade"
        id="materia-{{ forloop.counter }}"
        role="tabpanel"
      >
        <h2>Planes de Clases - {{ materia }}</h2>
        <br />
        <a
          class="btn btn-primary"
          href="{% url 'planes_create' materia=materia %}"
        >
          <i class="fa-solid fa-plus"></i> Nuevo Plan </a
        ><br />

        {% with planes_materia=planes|dictsort:"materia" %}
        <div>
          {% if planes_materia %}
          <table class="table table-bordered">
            <thead>
              <tr>
                <th>Número de Plan</th>
                <th>Tema de Clase</th>
                <th>Acciones</th>
              </tr>
            </thead>
            <tbody>
              {% for plan in planes_materia %}
              <tr>
                <!-- Comprobamos si hay actividades asociadas a este plan -->
                {% if plan.numero_actividad.all %}
                <div>{% for actividad in plan.numero_actividad.all %}</div>
                <!-- Verificar si la actividad está asociada a la materia -->
                {% if actividad.materia == materia %}
                <td>{{ plan.plan_nombre }}</td>
                <td>{{ actividad.tema }}</td>
                <td>
                  <a
                    href="{% url 'plan_pdf' plan.id %}"
                    target="_blank"
                    class="btn btn-primary"
                  >
                    <i class="fa-solid fa-download"></i> Descargar
                  </a>
                </td>
                {% endif %} {% endfor %} {% else %}
                <td colspan="3" class="text-center">
                  Este plan no tiene actividades asociadas.
                </td>
                {% endif %}
              </tr>
              {% empty %}
              <tr>
                <td colspan="3" class="text-center">
                  No hay planes registrados para esta materia.
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
          {% else %}
          <div class="alert alert-info">
            No existen planes asociados a esta materia.
          </div>
          {% endif %}
        </div>
        {% endwith %}
      </div>
      {% endfor %}
    </div>
  </div>
</div>

{% endblock %}
